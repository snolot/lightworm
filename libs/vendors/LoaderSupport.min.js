"use strict";void 0===THREE.LoaderSupport&&(THREE.LoaderSupport={}),THREE.LoaderSupport.Validator={isValid:function(e){return null!==e&&void 0!==e},verifyInput:function(e,t){return null===e||void 0===e?t:e}},THREE.LoaderSupport.Callbacks=function(){function e(){this.onProgress=null,this.onMeshAlter=null,this.onLoad=null,this.onLoadMaterials=null}var t=THREE.LoaderSupport.Validator;return e.prototype.setCallbackOnProgress=function(e){this.onProgress=t.verifyInput(e,this.onProgress)},e.prototype.setCallbackOnMeshAlter=function(e){this.onMeshAlter=t.verifyInput(e,this.onMeshAlter)},e.prototype.setCallbackOnLoad=function(e){this.onLoad=t.verifyInput(e,this.onLoad)},e.prototype.setCallbackOnLoadMaterials=function(e){this.onLoadMaterials=t.verifyInput(e,this.onLoadMaterials)},e}(),THREE.LoaderSupport.LoadedMeshUserOverride=function(){function e(e,t){this.disregardMesh=!0===e,this.alteredMesh=!0===t,this.meshes=[]}return e.prototype.addMesh=function(e){this.meshes.push(e),this.alteredMesh=!0},e.prototype.isDisregardMesh=function(){return this.disregardMesh},e.prototype.providesAlteredMeshes=function(){return this.alteredMesh},e}(),THREE.LoaderSupport.ResourceDescriptor=function(){function e(e,r){var i=e.split("/");i.length<2?(this.path=null,this.name=e,this.url=e):(this.path=t.verifyInput(i.slice(0,i.length-1).join("/")+"/",null),this.name=t.verifyInput(i[i.length-1],null),this.url=e),this.extension=t.verifyInput(r,"default"),this.extension=this.extension.trim(),this.content=null}var t=THREE.LoaderSupport.Validator;return e.prototype.setContent=function(e){this.content=t.verifyInput(e,null)},e}(),THREE.LoaderSupport.PrepData=function(){function e(e){this.logging={enabled:!0,debug:!1},this.modelName=t.verifyInput(e,""),this.resources=[],this.callbacks=new THREE.LoaderSupport.Callbacks}var t=THREE.LoaderSupport.Validator;return e.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},e.prototype.getCallbacks=function(){return this.callbacks},e.prototype.addResource=function(e){this.resources.push(e)},e.prototype.clone=function(){var e=new THREE.LoaderSupport.PrepData(this.modelName);e.logging.enabled=this.logging.enabled,e.logging.debug=this.logging.debug,e.resources=this.resources,e.callbacks=this.callbacks;var t,r;for(t in this)r=this[t],e.hasOwnProperty(t)||"function"==typeof this[t]||(e[t]=r);return e},e.prototype.checkResourceDescriptorFiles=function(e,r){var i,o,n,s,a={};for(var l in e)if(i=e[l],s=!1,t.isValid(i.name))if(t.isValid(i.content)){for(n=0;n<r.length&&!s;n++)if(o=r[n],i.extension.toLowerCase()===o.ext.toLowerCase())if(o.ignore)s=!0;else if("ArrayBuffer"===o.type){if(!(i.content instanceof ArrayBuffer||i.content instanceof Uint8Array))throw"Provided content is not of type ArrayBuffer! Aborting...";a[o.ext]=i,s=!0}else if("String"===o.type){if(!("string"==typeof i.content||i.content instanceof String))throw"Provided  content is not of type String! Aborting...";a[o.ext]=i,s=!0}if(!s)throw'Unidentified resource "'+i.name+'": '+i.url}else{if(!("string"==typeof i.name||i.name instanceof String))throw"Provided file is not properly defined! Aborting...";for(n=0;n<r.length&&!s;n++)o=r[n],i.extension.toLowerCase()===o.ext.toLowerCase()&&(o.ignore||(a[o.ext]=i),s=!0);if(!s)throw'Unidentified resource "'+i.name+'": '+i.url}return a},e}(),THREE.LoaderSupport.MeshBuilder=function(){function e(){console.info("Using THREE.LoaderSupport.MeshBuilder version: "+t),this.logging={enabled:!0,debug:!1},this.callbacks=new THREE.LoaderSupport.Callbacks,this.materials=[]}var t="1.2.0",r=THREE.LoaderSupport.Validator;return e.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},e.prototype.init=function(){var e=new THREE.MeshStandardMaterial({color:14479871});e.name="defaultMaterial";var t=new THREE.MeshStandardMaterial({color:14479871});t.name="defaultVertexColorMaterial",t.vertexColors=THREE.VertexColors;var r=new THREE.LineBasicMaterial;r.name="defaultLineMaterial";var i=new THREE.PointsMaterial({size:1});i.name="defaultPointMaterial";var o={};o[e.name]=e,o[t.name]=t,o[r.name]=r,o[i.name]=i,this.updateMaterials({cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:o}})},e.prototype.setMaterials=function(e){var t={cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:r.isValid(this.callbacks.onLoadMaterials)?this.callbacks.onLoadMaterials(e):e}};this.updateMaterials(t)},e.prototype._setCallbacks=function(e){r.isValid(e.onProgress)&&this.callbacks.setCallbackOnProgress(e.onProgress),r.isValid(e.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(e.onMeshAlter),r.isValid(e.onLoad)&&this.callbacks.setCallbackOnLoad(e.onLoad),r.isValid(e.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(e.onLoadMaterials)},e.prototype.processPayload=function(e){return"meshData"===e.cmd?this.buildMeshes(e):"materialData"===e.cmd?(this.updateMaterials(e),null):void 0},e.prototype.buildMeshes=function(e){var t=e.params.meshName,i=new THREE.BufferGeometry;i.addAttribute("position",new THREE.BufferAttribute(new Float32Array(e.buffers.vertices),3)),r.isValid(e.buffers.indices)&&i.setIndex(new THREE.BufferAttribute(new Uint32Array(e.buffers.indices),1)),r.isValid(e.buffers.colors)&&i.addAttribute("color",new THREE.BufferAttribute(new Float32Array(e.buffers.colors),3)),r.isValid(e.buffers.normals)?i.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(e.buffers.normals),3)):i.computeVertexNormals(),r.isValid(e.buffers.uvs)&&i.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(e.buffers.uvs),2));var o,n,s,a=e.materials.materialNames,l=e.materials.multiMaterial,u=[];for(s in a)n=a[s],o=this.materials[n],l&&u.push(o);if(l){o=u;var c,p=e.materials.materialGroups;for(s in p)c=p[s],i.addGroup(c.start,c.count,c.index)}var d,h,g=[],f=this.callbacks.onMeshAlter,m=!0,b=r.verifyInput(e.geometryType,0);if(r.isValid(f)&&(h=f({detail:{meshName:t,bufferGeometry:i,material:o,geometryType:b}}),r.isValid(h))){if(!h.isDisregardMesh()&&h.providesAlteredMeshes())for(var k in h.meshes)g.push(h.meshes[k]);m=!1}m&&(e.computeBoundingSphere&&i.computeBoundingSphere(),(d=0===b?new THREE.Mesh(i,o):1===b?new THREE.LineSegments(i,o):new THREE.Points(i,o)).name=t,g.push(d));var y;if(r.isValid(g)&&g.length>0){var w=[];for(var k in g)d=g[k],w[k]=d.name;y="Adding mesh(es) ("+w.length+": "+w+") from input mesh: "+t,y+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)"}else y="Not adding mesh: "+t,y+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)";var v=this.callbacks.onProgress;return r.isValid(v)&&v(new CustomEvent("MeshBuilderEvent",{detail:{type:"progress",modelName:e.params.meshName,text:y,numericalValue:e.progress.numericalValue}})),g},e.prototype.updateMaterials=function(e){var t,i,o=e.materials.materialCloneInstructions;if(r.isValid(o)){var n=o.materialNameOrg,s=this.materials[n];if(r.isValid(n)){t=s.clone(),i=o.materialName,t.name=i;var a=o.materialProperties;for(var l in a)t.hasOwnProperty(l)&&a.hasOwnProperty(l)&&(t[l]=a[l]);this.materials[i]=t}else console.warn('Requested material "'+n+'" is not available!')}var u=e.materials.serializedMaterials;if(r.isValid(u)&&Object.keys(u).length>0){var c,p=new THREE.MaterialLoader;for(i in u)c=u[i],r.isValid(c)&&(t=p.parse(c),this.logging.enabled&&console.info('De-serialized material with name "'+i+'" will be added.'),this.materials[i]=t)}if(u=e.materials.runtimeMaterials,r.isValid(u)&&Object.keys(u).length>0)for(i in u)t=u[i],this.logging.enabled&&console.info('Material with name "'+i+'" will be added.'),this.materials[i]=t},e.prototype.getMaterialsJSON=function(){var e,t={};for(var r in this.materials)e=this.materials[r],t[r]=e.toJSON();return t},e.prototype.getMaterials=function(){return this.materials},e}(),THREE.LoaderSupport.WorkerRunnerRefImpl=function(){function e(){var e=this;self.addEventListener("message",function(t){e.processMessage(t.data)},!1)}return e.prototype.applyProperties=function(e,t){var r,i,o;for(r in t)i="set"+r.substring(0,1).toLocaleUpperCase()+r.substring(1),o=t[r],"function"==typeof e[i]?e[i](o):e.hasOwnProperty(r)&&(e[r]=o)},e.prototype.processMessage=function(e){if("run"===e.cmd){var t={callbackMeshBuilder:function(e){self.postMessage(e)},callbackProgress:function(t){e.logging.enabled&&e.logging.debug&&console.debug("WorkerRunner: progress: "+t)}},r=new Parser;"function"==typeof r.setLogging&&r.setLogging(e.logging.enabled,e.logging.debug),this.applyProperties(r,e.params),this.applyProperties(r,e.materials),this.applyProperties(r,t),r.workerScope=self,r.parse(e.data.input,e.data.options),e.logging.enabled&&console.log("WorkerRunner: Run complete!"),t.callbackMeshBuilder({cmd:"complete",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+e.cmd)},e}(),THREE.LoaderSupport.WorkerSupport=function(){function e(){if(console.info("Using THREE.LoaderSupport.WorkerSupport version: "+t),this.logging={enabled:!0,debug:!1}/*,void 0===window.Worker)throw"This browser does not support web workers!";if(void 0===window.Blob)throw"This browser does not support Blob!";if("function"!=typeof window.URL.createObjectURL)throw"This browser does not support Object creation from URL!";*/this.loaderWorker=new i}var t="2.2.0",r=THREE.LoaderSupport.Validator,i=function(){function e(){this._reset()}return e.prototype._reset=function(){this.logging={enabled:!0,debug:!1},this.worker=null,this.runnerImplName=null,this.callbacks={meshBuilder:null,onLoad:null},this.terminateRequested=!1,this.queuedMessage=null,this.started=!1,this.forceCopy=!1},e.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},e.prototype.setForceCopy=function(e){this.forceCopy=!0===e},e.prototype.initWorker=function(e,t){this.runnerImplName=t;var r=new Blob([e],{type:"application/javascript"});this.worker=new Worker(window.URL.createObjectURL(r)),this.worker.onmessage=this._receiveWorkerMessage,this.worker.runtimeRef=this,this._postMessage()},e.prototype._receiveWorkerMessage=function(e){var t=e.data;switch(t.cmd){case"meshData":case"materialData":case"imageData":this.runtimeRef.callbacks.meshBuilder(t);break;case"complete":this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run is complete. Terminating application on request!"),this.runtimeRef._terminate());break;case"error":console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Reported error: "+t.msg),this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run reported error. Terminating application on request!"),this.runtimeRef._terminate());break;default:console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Received unknown command: "+t.cmd)}},e.prototype.setCallbacks=function(e,t){this.callbacks.meshBuilder=r.verifyInput(e,this.callbacks.meshBuilder),this.callbacks.onLoad=r.verifyInput(t,this.callbacks.onLoad)},e.prototype.run=function(e){if(r.isValid(this.queuedMessage))console.warn("Already processing message. Rejecting new run instruction");else{if(this.queuedMessage=e,this.started=!0,!r.isValid(this.callbacks.meshBuilder))throw'Unable to run as no "MeshBuilder" callback is set.';if(!r.isValid(this.callbacks.onLoad))throw'Unable to run as no "onLoad" callback is set.';"run"!==e.cmd&&(e.cmd="run"),r.isValid(e.logging)?(e.logging.enabled=!0===e.logging.enabled,e.logging.debug=!0===e.logging.debug):e.logging={enabled:!0,debug:!1},this._postMessage()}},e.prototype._postMessage=function(){if(r.isValid(this.queuedMessage)&&r.isValid(this.worker))if(this.queuedMessage.data.input instanceof ArrayBuffer){var e;e=this.forceCopy?this.queuedMessage.data.input.slice(0):this.queuedMessage.data.input,this.worker.postMessage(this.queuedMessage,[e])}else this.worker.postMessage(this.queuedMessage)},e.prototype.setTerminateRequested=function(e){this.terminateRequested=!0===e,this.terminateRequested&&r.isValid(this.worker)&&!r.isValid(this.queuedMessage)&&this.started&&(this.logging.enabled&&console.info("Worker is terminated immediately as it is not running!"),this._terminate())},e.prototype._terminate=function(){this.worker.terminate(),this._reset()},e}();e.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t,this.loaderWorker.setLogging(this.logging.enabled,this.logging.debug)},e.prototype.setForceWorkerDataCopy=function(e){this.loaderWorker.setForceCopy(e)},e.prototype.validate=function(e,t,i,s,a){if(!r.isValid(this.loaderWorker.worker)){this.logging.enabled&&(console.info("WorkerSupport: Building worker code..."),console.time("buildWebWorkerCode")),r.isValid(a)?this.logging.enabled&&console.info('WorkerSupport: Using "'+a.name+'" as Runner class for worker.'):(a=THREE.LoaderSupport.WorkerRunnerRefImpl,this.logging.enabled&&console.info('WorkerSupport: Using DEFAULT "THREE.LoaderSupport.WorkerRunnerRefImpl" as Runner class for worker.'));var l=e(o,n);l+="var Parser = "+t+";\n\n",l+=n(a.name,a),l+="new "+a.name+"();\n\n";var u=this;if(r.isValid(i)&&i.length>0){var c="",p=function(e,t){if(0===t.length)u.loaderWorker.initWorker(c+l,a.name),u.logging.enabled&&console.timeEnd("buildWebWorkerCode");else{var r=new THREE.FileLoader;r.setPath(e),r.setResponseType("text"),r.load(t[0],function(r){c+=r,p(e,t)}),t.shift()}};p(s,i)}else this.loaderWorker.initWorker(l,a.name),this.logging.enabled&&console.timeEnd("buildWebWorkerCode")}},e.prototype.setCallbacks=function(e,t){this.loaderWorker.setCallbacks(e,t)},e.prototype.run=function(e){this.loaderWorker.run(e)},e.prototype.setTerminateRequested=function(e){this.loaderWorker.setTerminateRequested(e)};var o=function(e,t){var r,i=e+" = {\n";for(var o in t)"string"==typeof(r=t[o])||r instanceof String?i+="\t"+o+': "'+(r=(r=r.replace("\n","\\n")).replace("\r","\\r"))+'",\n':r instanceof Array?i+="\t"+o+": ["+r+"],\n":Number.isInteger(r)?i+="\t"+o+": "+r+",\n":"function"==typeof r&&(i+="\t"+o+": "+r+",\n");return i+="}\n\n"},n=function(e,t,i,o,n){var s,a,l="",u=r.isValid(i)?i:t.name;n=r.verifyInput(n,[]);for(var c in t.prototype)s=t.prototype[c],"constructor"===c?a="\tfunction "+u+s.toString().replace("function","")+";\n\n":"function"==typeof s&&n.indexOf(c)<0&&(l+="\t"+u+".prototype."+c+" = "+s.toString()+";\n\n");l+="\treturn "+u+";\n",l+="})();\n\n";var p="";return r.isValid(o)&&(p+="\n",p+=u+".prototype = Object.create( "+o+".prototype );\n",p+=u+".constructor = "+u+";\n",p+="\n"),r.isValid(a)?l=e+" = (function () {\n\n"+p+a+l:(a=e+" = (function () {\n\n",l=(a+=p+"\t"+t.prototype.constructor.toString()+"\n\n")+l),l};return e}(),THREE.LoaderSupport.WorkerDirector=function(){function e(e){if(console.info("Using THREE.LoaderSupport.WorkerDirector version: "+t),this.logging={enabled:!0,debug:!1},this.maxQueueSize=o,this.maxWebWorkers=i,this.crossOrigin=null,!r.isValid(e))throw"Provided invalid classDef: "+e;this.workerDescription={classDef:e,globalCallbacks:{},workerSupports:{},forceWorkerDataCopy:!0},this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0,this.callbackOnFinishedProcessing=null}var t="2.2.0",r=THREE.LoaderSupport.Validator,i=16,o=8192;return e.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},e.prototype.getMaxQueueSize=function(){return this.maxQueueSize},e.prototype.getMaxWebWorkers=function(){return this.maxWebWorkers},e.prototype.setCrossOrigin=function(e){this.crossOrigin=e},e.prototype.setForceWorkerDataCopy=function(e){this.workerDescription.forceWorkerDataCopy=!0===e},e.prototype.prepareWorkers=function(e,t,n){r.isValid(e)&&(this.workerDescription.globalCallbacks=e),this.maxQueueSize=Math.min(t,o),this.maxWebWorkers=Math.min(n,i),this.maxWebWorkers=Math.min(this.maxWebWorkers,this.maxQueueSize),this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0;for(var s=0;s<this.maxWebWorkers;s++){var a=new THREE.LoaderSupport.WorkerSupport;a.setLogging(this.logging.enabled,this.logging.debug),a.setForceWorkerDataCopy(this.workerDescription.forceWorkerDataCopy),this.workerDescription.workerSupports[s]={instanceNo:s,inUse:!1,terminateRequested:!1,workerSupport:a,loader:null}}},e.prototype.enqueueForRun=function(e){this.instructionQueue.length<this.maxQueueSize&&this.instructionQueue.push(e)},e.prototype.isRunning=function(){var e=Object.keys(this.workerDescription.workerSupports);return this.instructionQueue.length>0&&this.instructionQueuePointer<this.instructionQueue.length||e.length>0},e.prototype.processQueue=function(){var e,t;for(var r in this.workerDescription.workerSupports)(t=this.workerDescription.workerSupports[r]).inUse||(this.instructionQueuePointer<this.instructionQueue.length?(e=this.instructionQueue[this.instructionQueuePointer],this._kickWorkerRun(e,t),this.instructionQueuePointer++):this._deregister(t));this.isRunning()||null===this.callbackOnFinishedProcessing||(this.callbackOnFinishedProcessing(),this.callbackOnFinishedProcessing=null)},e.prototype._kickWorkerRun=function(e,t){t.inUse=!0,t.workerSupport.setTerminateRequested(t.terminateRequested),this.logging.enabled&&console.info("\nAssigning next item from queue to worker (queue length: "+this.instructionQueue.length+")\n\n");var i=this,o=e.getCallbacks(),n=this.workerDescription.globalCallbacks;t.loader=this._buildLoader(t.instanceNo);var s=new THREE.LoaderSupport.Callbacks;s.setCallbackOnLoad(function(e){r.isValid(n.onLoad)&&n.onLoad(e),r.isValid(o.onLoad)&&o.onLoad(e),i.objectsCompleted++,t.inUse=!1,i.processQueue()}),s.setCallbackOnProgress(function(e){r.isValid(n.onProgress)&&n.onProgress(e),r.isValid(o.onProgress)&&o.onProgress(e)}),s.setCallbackOnMeshAlter(function(e){r.isValid(n.onMeshAlter)&&n.onMeshAlter(e),r.isValid(o.onMeshAlter)&&o.onMeshAlter(e)}),e.callbacks=s,t.loader.run(e,t.workerSupport)},e.prototype._buildLoader=function(e){var t=this.workerDescription.classDef,i=Object.create(t.prototype);if(t.call(i,THREE.DefaultLoadingManager),!i.hasOwnProperty("instanceNo"))throw t.name+' has no property "instanceNo".';if(i.instanceNo=e,!i.hasOwnProperty("workerSupport"))throw t.name+' has no property "workerSupport".';if("function"!=typeof i.run)throw t.name+' has no function "run".';return i.hasOwnProperty("callbacks")&&r.isValid(i.callbacks)||(console.warn(t.name+' has an invalid property "callbacks". Will change to "THREE.LoaderSupport.Callbacks"'),i.callbacks=new THREE.LoaderSupport.Callbacks),i},e.prototype._deregister=function(e){if(r.isValid(e)){e.workerSupport.setTerminateRequested(!0),this.logging.enabled&&console.info("Requested termination of worker #"+e.instanceNo+".");var t=e.loader.callbacks;r.isValid(t.onProgress)&&t.onProgress({detail:{text:""}}),delete this.workerDescription.workerSupports[e.instanceNo]}},e.prototype.tearDown=function(e){this.logging.enabled&&console.info("WorkerDirector received the deregister call. Terminating all workers!"),this.instructionQueuePointer=this.instructionQueue.length,this.callbackOnFinishedProcessing=r.verifyInput(e,null);for(var t in this.workerDescription.workerSupports)this.workerDescription.workerSupports[t].terminateRequested=!0},e}();